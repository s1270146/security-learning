# RSA暗号

# RSA暗号に対する基本的な攻撃

## 同報通信

同じ情報をRSAで暗号化して複数に送るときは注意が必要

$k$個の公開鍵$(N_i, e)$を用いて、あるメッセージ$m$を用いて暗号文$c_1,c_2,\cdots,c_k$を計算すると

$$
\begin{array}{l}
c_1 \equiv m^e \pmod {N_1} \\
c_2 \equiv m^e \pmod {N_2} \\
\vdots \\
c_k \equiv m^e \pmod {N_k} 
\end{array}
$$

これを中国剰余定理を使うと法$N_1N_2\cdots N_k$における$m^e$を計算できるため、$m^e < N_1N_2\cdots N_k$となる場合は$e$乗根を取ることで平文を得ることができる。

$n$ビットの数と$m$ビットの数を掛けると値は最大で$n+m$ビットになるので、$e$個暗号文を集めれば中国剰余定理により復号できる。

また、同じ$N$に対して互いに素な２つの$e$を用いて暗号化した場合も解くことができる。

$e_1, e_2$が互いに素で$e_1 > e_2$のとき、

$$
c_1 \equiv m^e \pmod {N} \\
c_2 \equiv m^e \pmod {N} \\
$$

とする。このとき
$$
e_1x+e_2y = 1
$$

となるような$(x, y)$の組は拡張ユークリッドの互除法で求めることができる。

$$
c_1^{x}c_2^{y} \equiv m^{e_1x+e_2y} \pmod N \\
\equiv m \pmod N
$$

## Nが素因数分解可能な場合

### 小さな素数

256bitくらいまでの素因数は個人で用意できる環境で素因数分解ができなくない

### YAFU

色々な素因数分解アルゴリズムに対応する素因数分解ツール

ヒントがないRSA暗号の問題がでたら使ってみる

### primefac

複数の素因数分解に対応するPythonのモジュール

同じ問題でもYAFUを使うかprimefacを使うかで解けたり解けなかったりする

### CADO-NFS

RSA Factoring Challenge で最も優秀な成績を収めているツール

CTFでの出番はない

### 特殊な素因数

素因数のうち1つを$p$としたときに、$p-1$のもつ最大の素因数が小さい場合には$p-1$法という素因数分解が有効

ある整数$N$の最大の素因数が$B$以下であるとき、$N$は$B$-smoothであるという

$B$-smoothな数は、$B$以下の素数$p_1,p_2, \cdots,p_k$を用いて

$$
p_1^{a_1}\times p_2^{a_2}\times \cdots \times p_k^{a_k}
$$

と表せる

$B$-powersmoothな数は$B$-smoothであることに加えて、それぞれの素因数$p_i^{a_i}$が$B$以下であるような数

$p-1$法は$p-1$がpowersmoothという性質を満たしていると仮定して素因数分解を試すアルゴリズム

まず$B$を適当に定める。$B$-powersmoothな数を探索するため、$B$を大きく取れば素因数分解できる数が増えるがその分計算量も増える

次に、$B$-powersmoothな数のうち最大の数$M$を計算する。例えば$5$-smoothな数のうち最大あるのは$2^2 \times 3 \times 5 = 60$となる。

素因数分解したい数$N$と互いに素な任意の正整数$a$を用意し、$GCD(a^M-1, N)$を計算する。

$1$と$N$以外の最大公約数が得られた場合はその数が素因数となる

なぜかおれで素因数分解が成功するか→フェルマーの小定理を用いて$p$を素因数にもつような数を無理やり生成しているから

ここで計算した$M$は$B$-powersmoothである数すべてを約数に持つ。

つまり、$p-1$が$B$-powersmoothであるならば必ず$M$の約数になっている。

このとき、フェルマーの小定理より次の式が成り立つ

$$
a^M \equiv a^{k(p-1)} \equiv 1 \pmod p
$$

したがって、$a^M - 1$は$p$の倍数となる。

## ２つの平文の差が判明している場合

平文が２つあってそれらの差が分かっている場合は、Franklin-Reiter Related Message Attackという攻撃ができる

２つのうち一方の平文を$m$、平文の差を$d$とすると暗号文$c_1,c_2$は次のように表せる

$$
c_1 = m^e \pmod N \\
c_2 = (m+d)^e \pmod N
$$

ここで、$e=3$を考えると$c_1,c_2$は次のように表せる。

$$
c_1 = m^3 \pmod N \\
c_2 = (m+d)^3 \pmod N \\
= m^3+3m^2d+3md^2+d^3 \pmod N
$$

この$c_1,c_2$と平文の差$d$を使うと次のように四則演算で